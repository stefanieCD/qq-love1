import requests
import datetime
import os
import sys
import random

# ==========================================
# â˜ï¸ é…ç½®åŒº
# ==========================================

# 1. æ¨¡æ¿ ID
TEMPLATE_ID = os.environ.get("TEMPLATE_ID", "-yHfo5HM4Rn2OTBDgMDYgapaL4-GxReRRyPzGLVxriE")

# 2. æ•æ„Ÿä¿¡æ¯é…ç½®
try:
    APP_ID = os.environ["APP_ID"]
    APP_SECRET = os.environ["APP_SECRET"]
    GPT_API_KEY = os.environ.get("GPT_API_KEY") 
except KeyError:
    print("âŒ é”™è¯¯ï¼šç¯å¢ƒå˜é‡ APP_ID æˆ– APP_SECRET ç¼ºå¤±ï¼")
    APP_ID = None
    APP_SECRET = None

# 3. ç”¨æˆ·åˆ—è¡¨
USERS = [
    "o13257d7f-0B3aLMx8UGIAaGZkUY", 
    "o13257XIz2XpWkacUw08fny0mNyE"
]

# 4. å…¶ä»–é…ç½®
CITY = "æ·±åœ³"
CLICK_URL = "https://tianqi.qq.com/index.htm"

# ==========================================
# ğŸ’– ä¸“å±å®šåˆ¶æƒ…è¯åº“ (å« ç…¤æ°” & å°å¸ƒä¸ é™å®šç‰ˆ)
# ==========================================
LOVE_WORDS = [
    # --- ç…¤æ°” & å°å¸ƒä¸ ä¸“å±é™å®š ---
    "ç…¤æ°”æ—©å®‰ï¼Œå°å¸ƒä¸ä»Šå¤©æ—©ä¸Šç‰¹åˆ«ç²¾ç¥ï¼Œå› ä¸ºå®ƒæƒ³ä½ äº†ã€‚",
    "çªçªä½ æ˜¯æˆ‘çš„ç…¤æ°”ï¼Œæˆ‘æ˜¯ä½ çš„å°å¸ƒä¸ï¼Œæˆ‘ä»¬å¤©ç”Ÿä¸€å¯¹ã€‚",
    "ä»Šå¤©å¤©æ°”çœŸå¥½ï¼Œå°å¸ƒä¸ç”³è¯·æƒ³è§ç…¤æ°”ä¸€é¢ã€‚",
    "ç…¤æ°”ç…¤æ°”ï¼Œåªè¦ä¸€æƒ³åˆ°ä½ ï¼Œå°å¸ƒä¸å°±æ§åˆ¶ä¸ä½åœ°å¼€å¿ƒã€‚",
    "è™½ç„¶æˆ‘æ˜¯ææ¨ï¼Œä½†æ­¤æ—¶æ­¤åˆ»ï¼Œæˆ‘åªæ˜¯ç…¤æ°”çš„å°å¸ƒä¸ã€‚",
    "å°å¸ƒä¸è¯´å®ƒæ˜¨æ™šåšæ¢¦æ¢¦åˆ°ç…¤æ°”äº†ï¼Œè‡³äºæ¢¦åˆ°äº†ä»€ä¹ˆ...è§é¢å‘Šè¯‰ä½ ã€‚",
    "ä½ æ˜¯å¤§å®¶çš„çªçªï¼Œä½†ç”±äºæˆ‘æ˜¯ä½ çš„å°å¸ƒä¸ï¼Œæ‰€ä»¥æˆ‘æ‹¥æœ‰æœ€ç»ˆè§£é‡Šæƒã€‚",
    "ç…¤æ°”æœ€è¿‘æœ‰æ²¡æœ‰ä¹–ä¹–åƒé¥­ï¼Ÿä¸ä¹–çš„è¯å°å¸ƒä¸å¯æ˜¯ä¼šæƒ©ç½šä½ çš„å“¦ã€‚",
    "æˆ‘æƒ³æŠŠå°å¸ƒä¸è—è¿›ç…¤æ°”çš„å£è¢‹é‡Œï¼Œéšèº«æºå¸¦ã€‚",
    "ä¸ä»…æˆ‘å–œæ¬¢ç…¤æ°”ï¼Œæˆ‘çš„å°å¸ƒä¸æ›´æ˜¯ç…¤æ°”çš„å¤´å·ç²‰ä¸ã€‚",
    "è­¦å‘Šï¼šç…¤æ°”è¯·æ³¨æ„ï¼Œä½ çš„å°å¸ƒä¸æ­£åœ¨é«˜é€Ÿå‘ä½ å¥”æ¥ã€‚",
    "åˆ«äººçš„æ—©å®‰æ˜¯æ—©å®‰ï¼Œæˆ‘çš„æ—©å®‰æ˜¯ï¼šå°å¸ƒä¸èµ·ç«‹æ•¬ç¤¼ï¼",
    "ç…¤æ°”ä¸åœ¨èº«è¾¹çš„æ¯ä¸€ç§’ï¼Œå°å¸ƒä¸éƒ½è§‰å¾—å­¤å•å¯‚å¯å†·ã€‚",
    "å¬è¯´ç…¤æ°”ä»Šå¤©å¾ˆæ¼‚äº®ï¼Ÿå°å¸ƒä¸è¡¨ç¤ºéå¸¸æƒ³äº²çœ¼ç¡®è®¤ä¸€ä¸‹ã€‚",
    "ä½ æ˜¯æˆ‘çš„ç”Ÿæ´»å¿…éœ€å“ï¼Œå°±åƒç…¤æ°”ä¸€æ ·é‡è¦ï¼ˆå°å¸ƒä¸ç‚¹å¤´åŒæ„ï¼‰ã€‚",
    
    # --- ç»å…¸ç²¾é€‰åº“ ---
    "è¿™æ˜¯æ‰‹èƒŒï¼Œè¿™æ˜¯è„šèƒŒï¼Œä½ æ˜¯æˆ‘çš„å®è´ç…¤æ°”ã€‚",
    "æœ€è¿‘æœ‰è°£è¨€è¯´æˆ‘å–œæ¬¢ä½ ï¼Œæˆ‘è¦æ¾„æ¸…ä¸€ä¸‹ï¼Œé‚£ä¸æ˜¯è°£è¨€ã€‚",
    "ä½ çŒœæˆ‘å–œæ¬¢ä»€ä¹ˆåˆ¶æœï¼Ÿè¢«ä½ åˆ¶æœã€‚",
    "æˆ‘è§‰å¾—ä½ ä»Šå¤©æœ‰ç‚¹æ€ªï¼Œæ€ªå¥½çœ‹çš„ã€‚",
    "ä½ çŸ¥é“æˆ‘çš„ç¼ºç‚¹æ˜¯ä»€ä¹ˆå—ï¼Ÿæ˜¯ç¼ºç‚¹ä½ ã€‚",
    "æˆ‘å‘ç°æ˜¨å¤©å¾ˆå–œæ¬¢ä½ ï¼Œä»Šå¤©ä¹Ÿå¾ˆå–œæ¬¢ä½ ï¼Œè€Œä¸”æœ‰é¢„æ„Ÿæ˜å¤©ä¹Ÿä¼šå–œæ¬¢ä½ ã€‚",
    "ä½ æœ€è¿‘æ˜¯ä¸æ˜¯åˆèƒ–äº†ï¼Ÿä¸ºä»€ä¹ˆåœ¨æˆ‘å¿ƒé‡Œçš„åˆ†é‡è¶Šæ¥è¶Šé‡äº†ï¼Ÿ",
    "è¿‘æœ±è€…èµ¤ï¼Œè¿‘ä½ è€…ç”œã€‚",
    "æˆ‘æ˜¯ä¹ï¼Œä½ æ˜¯ä¸‰ï¼Œé™¤äº†ä½ è¿˜æ˜¯ä½ ã€‚",
    "è«æ–‡è”šçš„é˜´å¤©ï¼Œå­™ç‡•å§¿çš„é›¨å¤©ï¼Œéƒ½ä¸å¦‚ä½ èŠå¤©çš„ç”»é¢ã€‚",
    "ä½ ä¸Šè¾ˆå­ä¸€å®šæ˜¯ç¢³é…¸é¥®æ–™å§ï¼Œä¸ºä»€ä¹ˆæˆ‘ä¸€çœ‹åˆ°ä½ å°±èƒ½å¼€å¿ƒåœ°å†’æ³¡ï¼Ÿ",
    "æˆ‘æƒ³ä¹°ä¸€å—åœ°ã€‚å“ªé‡Œçš„åœ°ï¼Ÿä½ çš„æ­»å¿ƒå¡Œåœ°ã€‚",
    "ä½ é—»åˆ°ä»€ä¹ˆå‘³é“äº†å—ï¼Ÿæ²¡æœ‰å•Šã€‚æ€ä¹ˆä½ ä¸€å‡ºæ¥ç©ºæ°”éƒ½æ˜¯ç”œçš„ï¼Ÿ",
    "å¸®æˆ‘æ´—ä¸ªä¸œè¥¿å¥½å—ï¼Ÿæ´—ä»€ä¹ˆï¼Ÿå–œæ¬¢æˆ‘ã€‚",
    "ä¸ç®¡æ˜¯æ™´å¤©é˜´å¤©é›¨å¤©ï¼Œèƒ½è§åˆ°ä½ çš„ä¸€å¤©ï¼Œå°±æ˜¯æœ€ç¿çƒ‚çš„ä¸€å¤©ã€‚",
    "æ—¢ç„¶ä½ æŠŠæˆ‘çš„å¿ƒå·²ç»å¼„ä¹±äº†ï¼Œé‚£ä½ æ‰“ç®—ä»€ä¹ˆæ—¶å€™æ¥å¼„ä¹±æˆ‘çš„åºŠï¼Ÿ",
    "ä½ çŸ¥é“æˆ‘æœ€çˆ±å–ä»€ä¹ˆå—ï¼Ÿå‘µæŠ¤ä½ ã€‚",
    "è½å¶å½’æ ¹ï¼Œæˆ‘å½’ä½ ã€‚",
    "å¦‚æœä¸çˆ±çªçªï¼Œæˆ‘çš„äººç”Ÿå°±åƒæ–­äº†çš„é“…ç¬”ï¼Œæ²¡æœ‰æ„ä¹‰ï¼ˆç¬”èŠ¯ï¼‰ã€‚",
    "ä»Šå¤©å¤©æ°”å¾ˆå¥½ï¼Œå¾ˆæƒ³å¸¦ä½ å»å¹å¹é£ï¼Œé¡ºä¾¿å‘Šè¯‰ä½ æˆ‘æœ‰å¤šæƒ³ä½ ã€‚",
    "ä½ æ˜¯ä¸æ˜¯é­”æœ¯å¸ˆï¼Ÿä¸ºä»€ä¹ˆä¸€çœ‹åˆ°ä½ ï¼Œå…¶ä»–äººéƒ½å˜æˆäº†èƒŒæ™¯ï¼Ÿ",
    "æˆ‘ç”Ÿç—…äº†ã€‚ä»€ä¹ˆç—…ï¼Ÿç›¸æ€ç—…ã€‚",
    "ä½ çŸ¥é“å¢™å£ï¼Œçœ¼ç›ï¼Œè†ç›–çš„è‹±æ–‡æ€ä¹ˆè¯´å—ï¼ŸWall, Eye, Knee. æˆ‘ä¹Ÿæ˜¯ï¼Œæˆ‘çˆ±ä½ ã€‚",
    "ä½ çŒœæˆ‘ä»€ä¹ˆæ˜Ÿåº§ï¼Ÿç™½ç¾Šï¼Ÿé”™ï¼Œæ˜¯ä¸ºä½ é‡èº«å®šåšã€‚",
    "ä½ æœ€è¿‘æ˜¯ä¸æ˜¯å·ä¸œè¥¿äº†ï¼Ÿå·äº†æˆ‘çš„å¿ƒã€‚",
    "æˆ‘è§‰å¾—ä½ å¥½åƒä¸€æ¬¾æ¸¸æˆã€‚ä»€ä¹ˆæ¸¸æˆï¼Ÿæˆ‘çš„ä¸–ç•Œã€‚",
    "ä½ é•¿å¾—å¥½åƒæˆ‘çš„ä¸€ä¸ªäº²æˆšã€‚è°ï¼Ÿæˆ‘å¦ˆçš„å„¿åª³å¦‡ã€‚",
    "ä½ å¯ä»¥å¸®æˆ‘ä¸ªå¿™å—ï¼Ÿå¸®å¿™çˆ±æˆ‘ã€‚",
    "ä½ çŸ¥é“æˆ‘ä¸ºä»€ä¹ˆæ„Ÿå†’äº†å—ï¼Ÿå› ä¸ºæˆ‘å¯¹ä½ æ²¡æœ‰æŠµæŠ—åŠ›ã€‚",
    "è¿™ä¸–ç•Œè½¦æ°´é©¬é¾™ï¼Œæˆ‘åªå¯¹ä½ æƒ…æœ‰ç‹¬é’Ÿã€‚",
    "ä½ çš„çœ¼ç›çœŸå¥½çœ‹ï¼Œé‡Œé¢æœ‰æ—¥æœˆå†¬å¤ï¼Œæ™´é›¨å±±å·ã€‚ä½†æˆ‘çš„çœ¼ç›æ›´å¥½çœ‹ï¼Œå› ä¸ºé‡Œé¢æœ‰ä½ ã€‚",
    "æˆ‘æ€€ç–‘ä½ çš„æœ¬è´¨æ˜¯ä¸€æœ¬ä¹¦ï¼Œä¸ç„¶ä¸ºä»€ä¹ˆè®©æˆ‘è¶Šçœ‹è¶Šæƒ³ç¡ã€‚",
    "ä½ ä»¥åèµ°è·¯èƒ½ä¸èƒ½å°å¿ƒç‚¹ï¼Ÿéè¦æ’åœ¨æˆ‘å¿ƒä¸Šã€‚",
    "ä½ çŸ¥é“å–ä»€ä¹ˆé…’æœ€å®¹æ˜“é†‰å—ï¼Ÿä½ çš„å¤©é•¿åœ°ä¹…ã€‚",
    "è¢«ä½ ç‚¹èµçš„æœ‹å‹åœˆï¼Œå«ç”œç”œåœˆã€‚",
    "æˆ‘çš„æ‰‹è¢«åˆ’äº†ä¸€é“å£å­ï¼Œä½ ä¹Ÿå»åˆ’ä¸€é“å§ï¼Œè¿™æ ·æˆ‘ä»¬å°±æ˜¯ä¸¤å£å­äº†ã€‚",
    "ä½ å±ä»€ä¹ˆï¼Ÿå±è™ã€‚ä¸ï¼Œä½ å±äºæˆ‘ã€‚",
    "æˆ‘æƒ³åƒä¸€ç¢—é¢ã€‚ä»€ä¹ˆé¢ï¼Ÿä½ çš„å¿ƒé‡Œé¢ã€‚",
    "æˆ‘åšäº‹ä»æ¥åªæœ‰ä¸‰åˆ†é’Ÿçƒ­åº¦ï¼Œä½†å¯¹ä½ ï¼Œæ˜¯ä¾‹å¤–ã€‚",
    "ä½ å–œæ¬¢åƒç³–å—ï¼Ÿä¸å–œæ¬¢ã€‚é‚£ä½ ä¸ºä»€ä¹ˆè¿™ä¹ˆç”œï¼Ÿ",
    "é‡åˆ°ä½ ä¹‹å‰ï¼Œæˆ‘æ²¡æƒ³è¿‡ç»“å©šï¼›é‡åˆ°ä½ ä¹‹åï¼Œæˆ‘æ²¡æƒ³è¿‡åˆ«äººã€‚",
    "æˆ‘æœ€è¿‘å­¦ä¼šäº†ä¸€é—¨æ–°æŠ€èƒ½ï¼Œå«â€˜æƒ³ä½ â€™ã€‚",
    "ä½ å¥½åƒå¦‚æœä¸å»å½“ç©ºæ°”å‡€åŒ–å™¨æœ‰ç‚¹æµªè´¹ï¼Œå› ä¸ºä½ åœ¨å“ªé‡Œï¼Œå“ªé‡Œçš„ç©ºæ°”å°±æ˜¯ç”œçš„ã€‚",
    "ä½ çŸ¥é“æˆ‘æœ€å–œæ¬¢ä»€ä¹ˆå­£èŠ‚å—ï¼Ÿæœ‰ä½ çš„å­£èŠ‚ã€‚",
    "æˆ‘æœ¬æ¥è¦è¡Œèµ°æ±Ÿæ¹–çš„ï¼Œä½†çœ‹åˆ°ä½ æˆ‘è§‰å¾—å¯ä»¥åœä¸‹æ¥äº†ã€‚",
    "ä½ èƒ½ä¸èƒ½é—­å˜´ï¼Ÿæˆ‘æ²¡æœ‰è¯´è¯å•Šã€‚é‚£ä¸ºä»€ä¹ˆæˆ‘æ»¡è„‘å­éƒ½æ˜¯ä½ çš„å£°éŸ³ï¼Ÿ",
    "ä½ çŸ¥é“æˆ‘æ‰‹æŒ‡ä¹‹é—´ä¸ºä»€ä¹ˆæœ‰ç¼éš™å—ï¼Ÿæ˜¯å› ä¸ºç­‰ä½ æ¥å¡«æ»¡ã€‚",
    "ä»ä»Šä»¥åï¼Œæˆ‘åªèƒ½ç§°å‘¼ä½ ä¸ºâ€˜æ‚¨â€™äº†ï¼Œå› ä¸ºä½ åœ¨æˆ‘å¿ƒä¸Šã€‚",
    "ä½ çš„ç¬‘ï¼Œæ˜¯å¤å¤©é‡Œçš„å†°æ·‡æ·‹ï¼Œå†¬å¤©é‡Œçš„æš–å®å®ã€‚",
    "æˆ‘å‘ç°ä½ æœ‰ä¸ªç‰¹ç‚¹ï¼Œå°±æ˜¯æ€ä¹ˆçœ‹éƒ½çœ‹ä¸è…»ã€‚",
    "ä½ è®©æˆ‘é“æ­‰ï¼Œæˆ‘ä¸‹æ¬¡è¿˜æ•¢ã€‚",
    "æˆ‘ä¸çœ‹æœˆäº®ï¼Œä¹Ÿä¸è¯´æƒ³ä½ ï¼Œè¿™æ ·æœˆäº®å’Œä½ éƒ½è’™åœ¨é¼“é‡Œã€‚",
    "è‰è“ã€è“è“ã€è”“è¶Šè“ï¼Œä»Šå¤©æƒ³ä½ äº†å—ï¼Ÿæƒ³äº†æ²¡ã€‚",
    "ä½ æ˜¯ä¸æ˜¯å¸¦äº†æ‰“ç«æœºï¼Ÿæ²¡æœ‰å•Šã€‚é‚£ä½ æ˜¯æ€ä¹ˆç‚¹ç‡ƒæˆ‘çš„å¿ƒçš„ï¼Ÿ",
    "å¦‚æœæˆ‘æ˜¯çŒ«ï¼Œä¹æ¡å‘½éƒ½æƒ³å’Œä½ è¿‡ã€‚",
    "æˆ‘çœŸçš„å¾ˆèŠ±å¿ƒï¼Œå–œæ¬¢æ¯ä¸€å¤©ä¸åŒæ ·å­çš„ä½ ã€‚",
    "ä½ ç¨å¾®è®°ä¸€ä¸‹ï¼Œæˆ‘æ‰¾ä½ çš„æ—¶å€™å°±æ˜¯æƒ³ä½ ï¼Œæ²¡æ‰¾ä½ çš„æ—¶å€™å°±æ˜¯æ†‹ç€åœ¨æƒ³ä½ ã€‚",
    "ä½ å¿™å½’å¿™ï¼Œä»€ä¹ˆæ—¶å€™æœ‰ç©ºå«ç»™æˆ‘ï¼Ÿ",
    "æˆ‘æˆ¿ç§Ÿåˆ°æœŸäº†ï¼Œå¯ä»¥å»ä½ çš„å¿ƒé‡Œä½å—ï¼Ÿ",
    "ä½ çŸ¥é“æˆ‘ä¸ºä»€ä¹ˆæ¯”ä½ é«˜å—ï¼Ÿå› ä¸ºå¤©å¡Œä¸‹æ¥æˆ‘å¸®ä½ æ‰›ã€‚",
    "æœ€è¿‘ä½“é‡ä¸Šå‡äº†ï¼Œç»å¯¹æ²¡æœ‰å·åƒï¼Œåªæ˜¯æŠŠä½ å·å·æ”¾åœ¨å¿ƒé‡Œã€‚",
    "åˆ«è®©æˆ‘çœ‹è§ä½ ï¼Œä¸ç„¶æˆ‘è§ä½ ä¸€æ¬¡ï¼Œå–œæ¬¢ä½ ä¸€æ¬¡ã€‚",
    "ä½ è‹¥å®‰å¥½ï¼Œä¾¿æ˜¯æ™´å¤©ã€‚æŒ‰è¿™å¤©æ°”çœ‹ï¼Œä½ åº”è¯¥æ˜¯æŒ‚äº†ã€‚ï¼ˆå¼€ç©ç¬‘çš„ï¼Œçˆ±ä½ ï¼ï¼‰",
    "æˆ‘æ”’äº†å¥½å¤šå¹´çš„æ¸©æŸ”å’Œæµªæ¼«ï¼Œæƒ³è¦ä¸€æ¬¡æ€§éƒ½ç»™ä½ ã€‚",
    "å¯¹äºä¸–ç•Œè€Œè¨€ï¼Œä½ æ˜¯ä¸€ä¸ªäººï¼›ä½†æ˜¯å¯¹äºæˆ‘è€Œè¨€ï¼Œä½ æ˜¯æ•´ä¸ªä¸–ç•Œã€‚",
    "æˆ‘çœ‹è¿‡å¾ˆå¤šé£æ™¯ï¼Œå”¯ç‹¬ä½ ï¼Œæ˜¯æœ€å¸å¼•æˆ‘çš„é‚£å¤„ã€‚",
    "ä¸ç®¡ä»¥ååˆ«äººè¯´ä»€ä¹ˆï¼Œæˆ‘åªä¿¡ä½ ã€‚",
    "å¦‚æœç”Ÿæ´»å¾ˆè‹¦ï¼Œé‚£ä½ å°±æ˜¯æˆ‘çš„ç³–ã€‚",
    "ä½ çš„åå­—ï¼Œæ˜¯æˆ‘è§è¿‡æœ€çŸ­çš„æƒ…è¯—ã€‚",
    "æ¯å¤©æ—©ä¸Šé†’æ¥ï¼Œçœ‹åˆ°ä½ å’Œé˜³å…‰éƒ½åœ¨ï¼Œå°±æ˜¯æˆ‘æƒ³è¦çš„æœªæ¥ã€‚",
    "æƒ³é€ä½ ä¸ªè¶…çº§å¯çˆ±çš„ç¤¼ç‰©ï¼Œå¯æ˜¯å¿«é€’å‘˜ä¸è®©æˆ‘é’»è¿›ç®±å­é‡Œã€‚",
    "æˆ‘èƒ½æƒ³åˆ°æœ€æµªæ¼«çš„äº‹ï¼Œå°±æ˜¯å’Œä½ ä¸€èµ·æ…¢æ…¢å˜è€ã€‚",
    "ä½ çŸ¥é“æˆ‘æœ€æƒ³å»çš„åœ°æ–¹æ˜¯å“ªé‡Œå—ï¼Ÿæ˜¯ä½ å¿ƒé‡Œã€‚",
    "ä¸–ç•Œé‚£ä¹ˆå¤§ï¼Œæˆ‘åªæƒ³æŒ¤è¿›ä½ å¿ƒé‡Œã€‚",
    "å’Œä½ åœ¨ä¸€èµ·ï¼Œè¿ç©ºæ°”éƒ½æ˜¯ç”œçš„ã€‚",
    "ä½ æ˜¯æˆ‘æ‰€æœ‰çš„å°‘å¥³æƒ…æ€€å’Œå¿ƒä¹‹æ‰€å‘ã€‚",
    "æƒ³å’Œä½ å–é…’æ˜¯å‡çš„ï¼Œæƒ³é†‰åœ¨ä½ æ€€é‡Œæ˜¯çœŸçš„ã€‚",
    "æˆ‘ä¸è¦çŸ­æš‚çš„æ¸©å­˜ï¼Œåªè¦ä½ ä¸€ä¸–çš„é™ªä¼´ã€‚",
    "ä½ æ˜¯æˆ‘ä¸´æ­»å‰è¿˜æƒ³æ‹”æ‰æ°§æ°”ç®¡äº²å»çš„äººã€‚",
    "æƒ³å’Œä½ åœ¨ä¸€èµ·ï¼Œä¸åˆ†ç§‹å†¬ï¼Œä¸é¡¾å†·æš–ã€‚",
    "æˆ‘è¿˜æ˜¯å¾ˆå–œæ¬¢ä½ ï¼Œåƒé£èµ°äº†å…«åƒé‡Œï¼Œä¸é—®å½’æœŸã€‚",
    "å¯¹ä½ çš„å–œæ¬¢ï¼Œå°±åƒä¸€æ¯æ°´ï¼Œçƒ­çš„å˜å‡‰ï¼Œå‡‰çš„å†å˜çƒ­ï¼Œåå¤æ— å¸¸ï¼Œå§‹ç»ˆä¸æ„¿æµªè´¹ã€‚",
    "æµ·åº•æœˆæ˜¯å¤©ä¸Šæœˆï¼Œçœ¼å‰äººæ˜¯å¿ƒä¸Šäººã€‚",
    "æ˜¥æ°´åˆç”Ÿï¼Œæ˜¥æ—åˆç››ï¼Œæ˜¥é£åé‡Œï¼Œä¸å¦‚ä½ ã€‚",
    "æ„¿æœ‰å²æœˆå¯å›é¦–ï¼Œä¸”ä»¥æ·±æƒ…å…±ç™½å¤´ã€‚",
    "ç²ç‘éª°å­å®‰çº¢è±†ï¼Œå…¥éª¨ç›¸æ€çŸ¥ä¸çŸ¥ã€‚",
    "æ—¢è®¸ä¸€äººä»¥åçˆ±ï¼Œæ„¿å°½ä½™ç”Ÿä¹‹æ…·æ…¨ã€‚",
    "è¿™é‡Œè’èŠœå¯¸è‰ä¸ç”Ÿï¼Œåæ¥ä½ æ¥è¿™èµ°äº†ä¸€é­ï¼Œå¥‡è¿¹èˆ¬ä¸‡ç‰©ç”Ÿé•¿ã€‚",
    "æˆ‘è¡Œè¿‡è®¸å¤šåœ°æ–¹çš„æ¡¥ï¼Œçœ‹è¿‡è®¸å¤šæ¬¡æ•°çš„äº‘ï¼Œå–è¿‡è®¸å¤šç§ç±»çš„é…’ï¼Œå´åªçˆ±è¿‡ä¸€ä¸ªæ­£å½“æœ€å¥½å¹´é¾„çš„äººã€‚",
    "ä»Šæ™šæœˆè‰²çœŸç¾ï¼Œé£ä¹Ÿæ¸©æŸ”ã€‚",
    "æœˆäº®ä¸ä¼šå¥”å‘ä½ ï¼Œä½†æˆ‘ä¼šï¼Œä¸è¿œä¸‡é‡Œçš„é‚£ç§ã€‚",
    "ç¯æ¸¸éäº†æ•´ä¸ªæ˜Ÿç³»ï¼Œæ‰¾ä¸åˆ°æ¯”ä½ æ›´äº®çš„æ˜Ÿæ˜Ÿã€‚",
    "ä½ æ˜¯è½æ—¥å¼¥æ¼«çš„æ©˜ï¼Œå¤©è¾¹é€äº®çš„æ˜Ÿã€‚",
    "æƒ³è®©ä½ å½“æˆ‘çš„å¿ƒå¤´è‚‰ï¼Œæ€ä¹ˆåˆ‡éƒ½ç–¼çš„é‚£ç§ã€‚",
    "å–œæ¬¢ä½ ï¼Œå§‹äºé¢œå€¼ï¼Œé™·äºæ‰åï¼Œå¿ äºäººå“ã€‚",
    "ä½ æ˜¯æˆ‘æ¼«æ¼«äººç”Ÿé‡Œæ–©é’‰æˆªé“çš„æ¢¦æƒ³ã€‚",
    "æ‰€æœ‰çš„æ™¦æš—éƒ½ç•™ç»™è¿‡å¾€ï¼Œä»é‡è§ä½ å¼€å§‹ï¼Œå‡›å†¬æ•£å°½ï¼Œæ˜Ÿæ²³é•¿æ˜ã€‚",
    "æˆ‘é‡è›®ç”Ÿé•¿ï¼Œæ²¡èƒ½æˆä¸ºè‡ªå·±çš„æœˆäº®ï¼Œèƒ½é‡è§ä½ æ˜¯é“¶æ²³èµ é€çš„ç³–ã€‚",
    "ä½ æ˜¯æˆ‘ç–²æƒ«ç”Ÿæ´»ä¸­çš„è‹±é›„æ¢¦æƒ³ã€‚",
    "å¸Œæœ›ä»Šæ™šçš„æ¢¦åäºŒåˆ†ç”œï¼Œä¸€åˆ†æ˜¯å®é™ï¼Œä¸€åˆ†æ˜¯æƒ¬æ„ï¼Œç„¶åæ¢¦é‡Œæœ‰ä½ ã€‚",
    "æƒ³åšä½ çš„å°æœ‹å‹ï¼Œå¤©çœŸï¼Œå¯çˆ±ï¼Œæœ€çˆ±ä½ ã€‚",
    "ä½ æ˜¯æˆ‘å¹³æ·¡ç”Ÿæ´»é‡Œçš„æ¥æ—¥æ–¹é•¿ã€‚",
    "æƒ³åšä½ æ€€é‡Œçš„çŒ«ï¼Œè¿ç¡è§‰éƒ½æ˜¯åœ¨æ’’å¨‡ã€‚",
    "å–œæ¬¢ä½ çš„æ„Ÿè§‰ï¼Œæ€ä¹ˆè¯´å‘¢ï¼Œæ¯”å†¬å¤©çš„æš–ç‚‰è¿˜æš–ï¼Œæ¯”å¤å¤©çš„å‡‰è¥¿ç“œè¿˜ç”œã€‚",
    "æˆ‘å–œæ¬¢ä½ ï¼Œä¸æ˜¯ä¸€è§é’Ÿæƒ…ï¼Œä¹Ÿä¸èƒ½è¯´åœå°±åœã€‚",
    "ä½ çœ¼ä¸­çš„æ˜Ÿæ²³ï¼Œæ˜¯æˆ‘æ­¤ç”Ÿä¸æ¸çš„ä¿¡ä»°ã€‚",
    "æƒ³æŠŠä¸–ç•Œä¸Šæ‰€æœ‰ç¾å¥½çš„ä¸œè¥¿éƒ½ç»™ä½ ï¼Œå´å‘ç°ä¸–ç•Œä¸Šæœ€ç¾å¥½çš„ä¸œè¥¿å°±æ˜¯ä½ ã€‚",
    "å’Œä½ åœ¨ä¸€èµ·çš„æ—¶å€™ï¼Œå¤©ç‰¹åˆ«è“ï¼Œé£ç‰¹åˆ«æ¸…çˆ½ï¼Œæ ‘å¶ç‰¹åˆ«ç»¿ï¼Œæ‰€æœ‰æ è¿‡çš„é£æ™¯éƒ½ç‰¹åˆ«è¿·äººã€‚",
    "ä½ æ˜¯å¹´å°‘çš„æ¬¢å–œï¼Œè¿™å¥è¯åè¿‡æ¥ä¹Ÿæ˜¯ä½ ã€‚",
    "å–œæ¬¢ä½ ï¼Œå°±åƒå‘¼å¸ä¸€æ ·è‡ªç„¶ï¼Œä¸éœ€è¦ç»ƒä¹ ã€‚",
    "ä½ çš„å£°éŸ³ï¼Œæ˜¯æˆ‘å¬è¿‡æœ€æ¸©æš–çš„æ—‹å¾‹ã€‚",
    "å’Œä½ åœ¨ä¸€èµ·ï¼Œæ—¶é—´è¿‡å¾—å¥½å¿«ï¼Œå¥½åƒä¸€çœ¨çœ¼å°±è¿‡äº†ä¸€ç”Ÿã€‚",
    "ä½ æ˜¯æˆ‘è—åœ¨å¿ƒåº•çš„ç§˜å¯†ï¼Œä¹Ÿæ˜¯æˆ‘æŒ‚åœ¨å˜´è¾¹çš„æ¬¢å–œã€‚",
    "æƒ³å’Œä½ ä¸€èµ·å»æ—…è¡Œï¼Œå»å“ªé‡Œä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯å’Œä½ åœ¨ä¸€èµ·ã€‚",
    "ä½ æ˜¯æˆ‘ç”Ÿå‘½ä¸­é‚£æŠ¹æœ€ç»šä¸½çš„è‰²å½©ã€‚",
    "å’Œä½ åœ¨ä¸€èµ·ï¼Œæˆ‘è§‰å¾—è‡ªå·±æ˜¯ä¸–ç•Œä¸Šæœ€å¹¸ç¦çš„äººã€‚",
    "ä½ æ˜¯æˆ‘æ— è®ºå¦‚ä½•éƒ½ä¸æƒ³é”™è¿‡çš„äººã€‚",
    "æƒ³ç‰µç€ä½ çš„æ‰‹ï¼Œå»æ•¬å„ä½æ¥å®¾çš„é…’ã€‚",
    "ä½ æ˜¯æˆ‘çš„å¿ƒå¿ƒå¿µå¿µï¼Œæ˜¯æˆ‘çš„æœæœæš®æš®ã€‚"
]

# ==========================================

def get_access_token():
    """è·å–å¾®ä¿¡ Access Token"""
    url = f"https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&appid={APP_ID}&secret={APP_SECRET}"
    try:
        resp = requests.get(url).json()
        return resp.get('access_token')
    except Exception as e:
        print(f"Token è·å–å¤±è´¥: {e}")
        return None

def get_weather_data():
    """è·å–å¤©æ°”æ•°æ®"""
    default_data = {"weather": "æ™´", "temp": "25â„ƒ"}
    try:
        url = f"http://autodev.openspeech.cn/csp/api/v2.1/weather?openId=aiuicus&clientType=android&sign=android&city={CITY}"
        res = requests.get(url).json()
        if res and res['data'] and res['data']['list']:
            today = res['data']['list'][0]
            return {
                "weather": today['weather'],
                "temp": f"{today['low']} ~ {today['high']}â„ƒ"
            }
    except Exception as e:
        print(f"å¤©æ°”è·å–å¤±è´¥: {e}")
    return default_data

def get_gpt_message():
    """
    è·å– GPT ç”Ÿæˆçš„æƒ…è¯å’Œå»ºè®®
    """
    
    # âš ï¸ å¦‚æœæ²¡æœ‰ Keyï¼Œç›´æ¥ç”¨æœ¬åœ°ä¸“å±åº“
    if not GPT_API_KEY:
        print("âš ï¸ æœªé…ç½® GPT_API_KEYï¼Œæ­£åœ¨ä»æœ¬åœ°æƒ…è¯åº“éšæœºæŠ½å–...")
        return random.choice(LOVE_WORDS), "è®°å¾—æŒ‰æ—¶åƒé¥­ï¼Œå¤šå–æ°´å“¦"
    
    # âš ï¸ GPT æç¤ºè¯å‡çº§ï¼šåŠ å…¥æ˜µç§°å’Œæš—å·è®¾å®š
    prompt = (
        "è¯·ç”Ÿæˆä¸¤å¥è¯ï¼Œç”¨|||éš”å¼€ã€‚"
        "ç¬¬ä¸€å¥æ˜¯ç»™å¥³æœ‹å‹çªçªï¼ˆæ˜µç§°å«ç…¤æ°”ï¼‰çš„æ—©å®‰æƒ…è¯ï¼ˆ20å­—å†…ï¼‰ï¼Œ"
        "é£æ ¼è¦ç”œç”šè‡³å¸¦ç‚¹åï¼Œå¯ä»¥å¶å°”æåˆ°â€˜å°å¸ƒä¸â€™ï¼ˆè¿™æ˜¯ç”·ç”Ÿçš„éšç§éƒ¨ä½æ˜µç§°ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬ä¹‹é—´çš„æƒ…ä¾£æš—å·ï¼Œè¯·ç”¨éšæ™¦ã€å¯çˆ±ã€è°ƒæƒ…çš„æ–¹å¼ä½¿ç”¨å®ƒï¼Œä¸è¦ä½ä¿—ï¼‰ï¼›"
        "ç¬¬äºŒå¥æ˜¯å¹½é»˜æ¸©é¦¨çš„ä»Šæ—¥å»ºè®®ï¼ˆ15å­—å†…ï¼‰ã€‚"
    )
    
    headers = {"Authorization": f"Bearer {GPT_API_KEY}"}
    data = {
        "model": "gpt-4o-mini", 
        "messages": [{"role": "user", "content": prompt}]
    }

    try:
        # å…¼å®¹ GitHub Actions çš„ç½‘ç»œç¯å¢ƒ
        url = "https://api.openai-proxy.com/v1/chat/completions"
        resp = requests.post(url, headers=headers, json=data, timeout=30)
        
        if resp.status_code != 200:
            print(f"âš ï¸ GPT è¯·æ±‚å¤±è´¥ (Code {resp.status_code})ï¼Œåˆ‡æ¢åˆ°æœ¬åœ°åº“ã€‚")
            return random.choice(LOVE_WORDS), "ä»Šå¤©è¦å¼€å¼€å¿ƒå¿ƒ"

        content = resp.json()["choices"][0]["message"]["content"].strip()
        
        if "|||" in content:
            parts = content.split("|||")
            return parts[0].strip(), parts[1].strip()
        return content[:20], "ä»Šå¤©è¦å¼€å¿ƒ"
    except Exception as e:
        print(f"âš ï¸ GPT æ¥å£å¼‚å¸¸: {e}ï¼Œåˆ‡æ¢åˆ°æœ¬åœ°åº“ã€‚")
        return random.choice(LOVE_WORDS), "è®°å¾—å¸¦ä¼æˆ–é˜²æ™’"

def send_message():
    token = get_access_token()
    if not token:
        print("æ— æ³•è·å– Tokenï¼Œç»ˆæ­¢å‘é€ã€‚")
        return

    # 1. è·å–æ•°æ®
    weather_data = get_weather_data()
    today_date = datetime.datetime.now().strftime("%Y-%m-%d")
    week_day = ["æ˜ŸæœŸä¸€", "æ˜ŸæœŸäºŒ", "æ˜ŸæœŸä¸‰", "æ˜ŸæœŸå››", "æ˜ŸæœŸäº”", "æ˜ŸæœŸå…­", "æ˜ŸæœŸæ—¥"][datetime.datetime.now().weekday()]
    msg_1, msg_2 = get_gpt_message()
    
    print(f"æ­£åœ¨å‘é€ -> æ—¥æœŸ:{today_date} å¤©æ°”:{weather_data['weather']} æƒ…è¯:{msg_1}")
    print(f"ä½¿ç”¨æ¨¡æ¿ ID: {TEMPLATE_ID}")

    # 2. æ„é€ å‘é€è¯·æ±‚
    for user_id in USERS:
        url = f"https://api.weixin.qq.com/cgi-bin/message/template/send?access_token={token}"
        
        payload = {
            "touser": user_id,
            "template_id": TEMPLATE_ID,
            "url": CLICK_URL,
            "data": {
                "date": {"value": f"{today_date} {week_day}", "color": "#00BFFF"},
                "city": {"value": CITY, "color": "#808080"},
                "weather": {"value": weather_data['weather'], "color": "#FFA500"},
                "temperature": {"value": weather_data['temp'], "color": "#FF6347"},
                "love_msg": {"value": msg_1, "color": "#FF1493"},
                "suggestion": {"value": msg_2, "color": "#32CD32"}
            }
        }
        
        resp = requests.post(url, json=payload).json()
        if resp.get("errcode") == 0:
            print(f"âœ… å‘é€ç»™ {user_id} æˆåŠŸ")
        else:
            print(f"âŒ å‘é€ç»™ {user_id} å¤±è´¥: {resp}")

if __name__ == "__main__":
    send_message()
